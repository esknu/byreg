---
title: "assignment"
format: html
editor: visual
bibliography: byreg.bib
language: nb.yaml 
---

```{r}
#| label: setup
#| output: false
#| message: false
#| echo: false
library(eurostat)
library(dineq)
library(readr)
library(tidyverse)
library(stringr)
library(huxtable)
library(vtable)
library(ggplotify)
library(grid)
library(dplyr)
library(gridExtra)
library(ggplot2)
library(broom)
library(lmtest)
library(plm)
```

Formålet og motivasjonen for denne artikkelen er å se på mulige pådrivere som påvirker by-land-skillet i Europa.
For å belyse dette skal vi kritisk undersøke hvordan faktorer påvirker by-land-skillet slik som arbeidsledighetsraten, sysselsettingsvekst og det lokale boligmarkedet påvirker mønstrene for befolkningsfordelingen og jobbskapingen på tvers av ulike europeiske land.
Vi skal henholdsvis se nærmere på landene Østerrike, Belgia, Tyskland, Danmark, Estland, Hellas, Spania, Finland, Frankrike, Irland, Italia, Luxembourg, Norge, Nederland, Polen, Portugal, Sverige, Slovenia, og Slovakia.

```{r}
#| echo: false
#| output: FALSE
# Les inn data og deaktiver visning av kolonnetypene
urban <- read_csv("ilc_lvho01__custom_9256830_linear.csv", na = "NA", show_col_types = FALSE)

urban <- urban |> 
  select(-DATAFLOW, -`LAST UPDATE`, -freq, -building, -OBS_FLAG, -building, -incgrp) 

urban <- urban |> 
  select(country = geo, location = deg_urb, year = TIME_PERIOD, Population = OBS_VALUE)
urban <- urban |> 
  mutate(location = recode(location,
                           "DEG1" = "City",
                           "DEG2" = "Suburb",
                           "DEG3" = "Rural"))

#deg1 = city, deg2 = towns and suburbs, deg3 = Rural areas
```

```{r}
#| echo: false
#| output: FALSE
Pop <- demo_pjan_custom_9363002_linear <- read_csv("demo_pjan__custom_9363002_linear.csv", 
    na = "NA")
```

## Litteraturgjennomgang

Manuel Wolff (2018) beskriver den økende polariseringen av både sentraliserende og desentraliserende voksende byer, samt en trend mot sentralisert tilbakegang.
Dette fenomenet peker på behovet for ulike planleggingstiltak.
Samtidig påpekes det at omlandet mister betydning, spesielt for synkende byer (Wolff, 2018).

Urbanisering er et fenomen som i økende grad påvirker økonomier, samfunn, kulturer og miljøet.
Ifølge OECD og Europakommisjonen (2020) forventes det at 55 % av verdens befolkning vil bo i byer innen 2050.
Denne veksten i bybefolkningen har skapt økt interesse for både den raske utviklingen og formen på urbane områder, samt for de tette båndene som eksisterer mellom individuelle byer og mellom byer og landlige områder.
En spesifikk politisk interesse retter seg mot megabyer og store metropolområder som drar nytte av agglomerasjon, industrielle klynger og innovasjon, men som samtidig står overfor betydelige utfordringer knyttet til bærekraftig byutvikling, for eksempel trafikkork eller miljøpåvirkninger (Union, E. (Ed.), 2021). 

Samtidig viser forskning at ulikhetene mellom urbane og rurale områder synes å minske.
Gjennom hierarkiske lineære regresjonsmodeller avdekkes det at inaktivitet øker både i urbane og rurale områder, selv om den er høyere i sistnevnte.
Denne økningen bidrar til å redusere den urbane-rurale forskjellen og eliminerer den til og med i noen land.
Dette fenomenet kan peke i retning av en økning i forstedene (suburbs), da det ser ut til å være en tendens til at de urbane og rurale karakterene blir mer like (Moreno-Llamas, García-Mayor, & De la Cruz-Sanchez, 2021).

På den andre siden står indre periferier i EU overfor betydelige utfordringer.
Disse områdene, som utgjør over 45 % av det europeiske territoriet, lider av periferi- og marginalitetsforhold.
De har dårlig tilgang til generelle tjenester, lavt økonomisk potensial på grunn av avstand til sentre for økonomisk aktivitet, og mangler relasjonell nærhet til maktsentre, noe som hindrer lokalsamfunnets aktive deltakelse i utviklingspolitikk.
Dette fører til demografisk tilbakegang, høy arbeidsledighet, sosial ekskludering, tap av lokal identitet og følgelig til nedlagte områder (De Toni, Di Martino & Dax, 2021).

## **Faktorer som påvirker befolkningsvekst**

I dette delkapittelet vil vi utforske ulike faktorer som påvirker befolkningsvekst.
Videre vil rapporten presentere tre teorier -- budrente teorien, shift-share-analyse og Williamson's inverterte U -- og vurdere i hvilken grad de beskriver og forklarer trender i befolkningsvekst.
Grunnet mangelfull data vil anvendelsen av teoriene benyttes i form av momenter som beskrivende faktorer for om befolkningsveksten i de overordnete valgte europeiske landene har en tendens til sentralisering eller desentralisering.

-   Med utgangspunkt i budrenteteorien er det to faktorer som avgjør hvor befolkningen bosetter seg i form av r (pris på bolig/rentekostnader) og distanse fra sentrum.
    Ettersom litteraturen viser til en større grad av teknologisk fremskritt på landsnivå, danner dette grunnlaget for at man ikke har et grunnleggende behov for å bo i sentrum for å kunne ta nytte av teknologien som er i sentrum.
    «Sentralisering til byene bidrar til økt press på boliger og priser.
    Det kan dermed være billigere å anskaffe leiligheter som er lokalisert i områder utenfor sentrum med lavere tetthet"(Artikkel. s. 2) og danner grunnlag for en økt grad av desentralisering da befolkningen får «mer for pengene» ved økt distanse til sentrum. Det er allikevel viktig å presisere at budrenteteorien har en bedre anvendelse på et bynivå og fungerer dårlig på landsnivå, men vil heller i prinsipp danne grunnlaget som et moment for desentralisering.

-   Shift - share - analyse er en økonomisk analysemetode som benyttes til å forstå veksten eller endringen i en bransje, økonomi, eller i dette tilfellet en endring i regionale veksthastigheter.
    I det tilgjengelige datamaterialet fra Eurostat vil å gjennomføre denne analysen ikke inneholde tilstrekkelig med data da "Den grunnleggende ideen for å beskrive regionale veksthastigheter påvirkes dette av tre faktorer i form av" (kilde; powerpoint kap 4):

    -   Den industrielle strukturen: Denne faktoren referer til sammensettingen av næringer eller sektorer i en bestemt region.

    -   Sektorens produktivitet: Produktiviteten til en sektor eller næring indikerer effektiviteten til produksjonsprosessen, hvor en økning i effektiviteten vil bidra positivt til den totale veksten.

    -   Dynamikken i etterspørsel og forbrukerpreferanser: Endringer i etterspørsel og forbrukerpreferanser påvirker hvilke varer og tjenester som etterspør.
        Den avgjørende faktoren her vil være i hvor stor grad regionen er kapabel til å tilpasse seg endringer.

        Man skiller shift-share-analysen i å bestå av Differensiell effekter (konkurransedyktighet) og Mix-effekter (Etterspørsel) som grunnlag for i hvilken grad en region gjør det bedre enn andre regioner i et land.
        Det kommer frem av tidligere forskning at sentrale områder har større konkurransekraft og vil da danne et grunnlag for at en shift-share-analysen er et moment for sentralisering.
        (kilde; urban sprawl)

På midten av 1960-tallet presenterte Williamson sin teori om regionale utviklingsfaser og forskjeller i et land.
Teorien gikk ut på at utvikling er konsentrert og polarisert i de tidlige stadiene, før den senere sprer seg til mer perifere områder (tettsteder og forsteder, og rurale områder).
Dette gir en kurve formet som en invertert U.

Årsakene til de økende ulikhetene er; (1) utvandring av kompetent arbeidskraft fra svake til sterke områder, (2) kapitalstrøm til de rikere regionene, tiltrukket av høyere etterspørsel, tilgjengelighet av infrastruktur, tjenester, et potensielt marked og bedre miljøforhold for bedrifter, (3) allokering av en større del av offentlige investeringer til sterke områder, som svar på etterspørsel, og (4) begrenset handel mellom regioner, slik at i de tidlige stadiene utøver ikke de rike regionene trekkraft på det fattige (KILDE, s. 105).

Til slutt vises mekanismer som virker i motsatt retning som fører til mindre ulikheter; (1) skaping av nye jobber i mindre utviklede regioner, med den konsekvensen at utvandring avtar eller til og med stopper opp, (2) klyngeulemper, som f.eks.
høye boligpriser, forurensing, trafikk og bråk, (3) vekst i offentlige investeringer i svake områder, og (4) begynnelsen av trekkraft utøvet av det sterke området på det svake (KILDE, s. 105).

Tilnærmingen til sentralitet/periferi:

Sentralitets/periferitets-tilnærmingen betrakter avstanden fra sentrum av økonomiske aktiviteter som årsaken til forsinket utvikling.
Enkelheten i denne tilnærmingen er også dens styrke.
Den påpeker rett og slett at geografisk sentralitet i seg selv er en faktor som fremmer utvikling, mens periferi hindrer det. Faktorer som avgjør dette er; (1) tilgang til informasjon; informasjonsinnhenting er en stor kostnad, (2) teknologisk kunnskap, (3) tilgjengeligheten av markedene for varer og produksjonsfaktorer, (4) transportkostnader for ferdige varer, råvarer og halvfabrikata, og (5) forsinkelser i adopsjonen av innovasjoner (KILDE, s. 111) ( KAP 11).

Kapittel 7:

En av årsakene til nedgangen i populasjonsveksten til rurale områder kan begrunnes av teorien om The spatial diffusion of innovation, (Capello, s.188).
Teorien forklarer hvordan distansen fra sentrale områder er en viktig del av teknologisk utvikling.
Flytter man langt fra sentrum vil en gradvis falle bak utviklingen og som Capello gjorde kjent, vil det å vente med å ta i bruk ny teknologi koste mer jo lengre en venter, kjent som Time trend of the costs of and revenues from adoption, figur 7.4 (Camagni and Capello (1998).

Livssyklusen på en tradisjonell innovasjon er formet som en omvendt U med slak helning.
I den senere tid med teknologisk utvikling har denne livssyklusen redusert kraftig, hvor ny teknologi stadig blir introdusert.
I følge Capello fører reduksjonen i livssyklusen til at områder som befinner seg langt fra sentrum, ikke rekker å tilpasse seg en teknologisk utvikling før det oppstår en ny (KILDE).

### Hypotese

Ut i fra budrenteteorien velger befolknigen hvor de vil bosette seg i form av betalingsvillighet og distanse fra sentrum.
Ettersom litteraturen viser til en større grad av teknologisk fremskritt på landsnivå, taler dette for at vi vil gjerne få en desentralisering av samfunnet, ettersom det er mindre trykk på boligprisen.
Merknad; budrenteteorien har en bedre anvendelse på et bynivå og fungerer i dårligere grad på landsnivå, allikvel mener vi at prinsippet danner grunnlaget for en hypotese om desentralisering.

Både litteraturen og teorien sett i lys av hverandre danner grunnlag for en hypotese om desentralisering.

### **Data-analyse:**

For å se nærmere på by-land-skillet trekker vi ut 3 underkatogorier av variabelen 'Region Type' i form av; 

-   Byer (tett befolkede områder)

-   Tettsteder og forsteder (områder med middels tetthet)

-   Rurale områder (tynt befolkede områder)

Vi skal nå analysere befolkningsveksttrender ved hjelp av disse kategoriene. 

```{r}
#| echo: false
Pop <- Pop |> 
  select(country = geo, year = TIME_PERIOD, Population = OBS_VALUE)
```

```{r}
#| echo: false
urb2 <- urban |> 
  left_join(Pop, urban, by = c("country", "year"))
```

```{r}
#| echo: false
urb2 <- urb2 |> 
  mutate(
    Pop = round((Population.x * Population.y)/100, digits = 0)
  )
```

```{r}
#| echo: false
datapt1 <- urb2 |> 
  select(Year = year, Country = country, Region_Type = location, Population = Pop) |> 
  filter(
    str_sub(Country, start = 1L, end = 2L) %in% c("AT", "BE", "DE", "DK", "ES", "FI", "FR", "IE", "IT", "NO", "NL", "PL", "PT", "SE", "SI", "SK")
  )
```

```{r}
#| echo: false
#| warning: false
#| message: false
#| label: fig-1
#| fig-cap: Befolkningsvekst for ulike regioner i perioden 2003-2022
datapt1 |> 
  ggplot(
    aes(
      x = Year,
      y = Population,
      color = Region_Type
    )
  ) +
  geom_smooth(level = 0.5, span = 1)
```

[Figur 1](#fig-1) viser gjennomsnittlig befolkningsvekst for de tre ulike regiontypene fra 2003 til 2022.
Vi ser en trend i befolkningsutviklingen frem til 2010 at byer har en markant størst vekst, dette kan forklares ved hjelp av momentet i shift-share-analysen om at byer har en størst konkurransekraft og effektivitet gjennom klyngefordeler som kjennetegner å være i sentrum.
Det vil også være en nærliggende forklaring at dynamikken mellom etterspørsel og forbruker preferanser skiller byer seg spesielt ut til å være kapabel til å tilpasse seg endringer ettersom sentrum gjerne kjennetegnes for å være ressurssterke, som fører til en sentralisering av samfunnet frem til 2010.
For resterende del av perioden trender i befolkningsveksten til en gradvis reduksjon av befolkningen i byer fra 2010 til 2016, før den flater ut i perioden 2017-2022.
Forklaringen på dette kan være at nedgangen skyldes budrenteteorien med hensyn på desentralisering, teknologiskutvikling og «spillovers» fra regions typen «city» til «suburb».

Skriv om suburb at trenden er kontunuerlig positiv; Dette kan skyldes spillover, teknologisk utvikling: infastuktur, tog og veinett til senturm, liffer suburb så langt fra sentrum i europeiske land?

og mer likhet i henhold til williamson teorien (bruk de som momenter)

Vi ser en trend i befolkningsveksten fra 2016 til 2022 en markant nedgang i rurale områder. 
Forklaringen på dette kan være sentralitets/periferitets-tilnærmingen, som betrakter avstanden fra sentrum av økonomiske aktiviteter som årsaken til forsinket utvikling.
Den påpeker at geografisk sentralitet i seg selv er en faktor som fremmer utvikling, mens periferi hindrer det. Faktorer som avgjør dette er; (1) tilgang til informasjon, (2) teknologisk kunnskap, (3) tilgjengeligheten av markedene for varer og produksjonsfaktorer, (4) transportkostnader for ferdige varer, råvarer og halvfabrikata, og (5) forsinkelser i adopsjonen av innovasjoner (Capello, s. 111).

Teorien om “The spatial diffusion of innovation” kan også være en mulig forklaring, som fokuserer på at distansen fra sentrale områder er en viktig del av teknologisk utvikling (Capello, s.188).
Flytter man langt fra sentrum vil en gradvis falle bak utviklingen og som Capello gjorde kjent, vil det å vente med å ta i bruk ny teknologi koste mer jo lengre en venter (Camagni and Capello (1998).

Oppsummerin/konklusjon: Desentralisering av europeiske land fra "city" til "suburd" dette skyldes momenter som budrente(mer for pengene), shift-share(teknologisk utvikling) og Williamson innverterte u (likheter)

Vi vil videre bruke 2005 som et indeksår, som definerer befolkningen til å være 100 i 2005.
Dette er på grunn av manglende observasjoner for år 2003 og 2004.
Dermed representerer kurvene prosentvis befolkningsvekst over den aktuelle perioden 2005 til 2022.

```{r}
#| echo: false
#| warning: false
#| message: false
#| label: fig-2
#| fig-cap: Relativ befolkningsvekst for ulike regioner i perioden 2003-2022
# Assuming your data frame is datapt1
datapt1 <- datapt1 %>%
  # Group by Country and Region_Type
  group_by(Country, Region_Type) %>%
  # Calculate relative growth
  mutate(Relative_Growth = Population / Population[Year == 2005]* 100) %>%
  ungroup()

```

Videre skal vi utforske variasjoner for ulike europeiske land.
Vi har gjort dette ved å dele utvalget av land fra Eurostat inn i tre hovedgrupper; urbaniserte land, mellomstore bosettingsland og rurale land.
Inndelingen er basert på bosettingsmønster for alle landene i datasettet, hvor vi har gruppert de landene som har lignende utvikling, se [Figur 9](#fig-9) i appendix.

Gruppe 1, urbaniserte land, består av Østerrike (AT), Belgia (BE), Tyskland (DE), Danmark (DK), Spania (ES), Finland (FI), Frankrike (FR), Italia (IT) og Nederland (NL).
Gruppe 2, mellomstore bosettingsland, består av Irland (IE), Norge (NO) og Sverige (SE).
Gruppe 3, rurale land, består av Polen (PL), Portugal (PT), Slovenia (SI) og Slovakia (SK).

Disse landene har trolig lignende utvikling innenfor sine grupper grunnet geografiske og kulturelle likheter.
F.eks.
deler landene i Gruppe 1, som Tyskland, Frankrike og Italia, lignende urbaniseringsmønstre og økonomiske strukturer på grunn av sin nærhet og felles historie.
Tilsvarende kan landene i Gruppe 3, som Polen og Slovakia, dele lignende utfordringer med rurale karakterer og tidligere kommunistisk historie.
Gruppe 2 viser imidlertid mer variasjon; Norge har en betydelig spredning av befolkning i mindre byer og spredtbygde områder, mens Irland og Sverige har mer markante bymessige og forstedlige bosettingsmønstre.

**Gruppe 1: Urbaniserte land**

```{r}
#| echo: false
City <- urb2 |> 
  select(Year = year, Country = country, Region_Type = location, Population = Pop) |> 
  filter(
    str_sub(Country, start = 1L, end = 2L) %in% c("AT", "BE", "DE", "DK", "ES", "FI", "FR", "IT", "NL")
  )
```

```{r}
#| echo: false
#| warning: false
#| message: false
#| label: fig-3
#| fig-cap: Relativ befolkningsvekst gruppe 1
City <- City %>%
  # Group by Country and Region Type
  group_by(Country, Region_Type) %>%
  # Calculate relative growth
  mutate(Relative_Growth = Population / Population[Year == 2005]* 100) %>%
  ungroup()

# Create a single graph with lines for each Region Type
City |> 
ggplot(aes(x = Year, y = Relative_Growth, color = Region_Type)) +
  geom_smooth(level = 0.5, span = 1, linetype = 1) +
  geom_hline(yintercept = 100, linetype = "dashed", color = "black") +
  labs(title = "Relative Population Growth from 2005",
       x = "Year",
       y = "Relative Growth",
       color = "Region_Type") +
  theme_minimal() +
  scale_x_continuous(breaks = seq(2005, max(datapt1$Year), by = 5))
```

[Figur 3](#fig-3) viser gjennomsnittlig relativ befolkningsvekst for de tre ulike regiontypene fra 2005 til 2022 for gruppe 1: Vesteuropeiske land, hvor 2005 = 100.
Populasjonen i rurale områder har opplevd en markant vekst fra 2005 til omtrent 2017, etterfulgt av en betydelig nedgang.
Denne trenden kan tyde på perioder med økt attraktivitet for rural bosetting, etterfulgt av utfordringer eller endringer som fører til nedgangen.
Tettsteder og forsteder har vist en jevn stigning i befolkningsvekst fra 2005 til 2022.
Dette kan reflektere en pågående urbaniserings- og suburbaniseringsprosess, der disse områdene forblir attraktive for bosetting.
Byområder har hatt en stabil befolkningsutvikling fra 2005 til omtrent 2010, etterfulgt av en nedgang frem til omtrent 2016.
Deretter har det vært en moderat økning frem til 2022.
Denne komplekse trenden kan indikere variasjoner i byenes attraktivitet eller endringer i byutviklingsmønstre over tid.

Samlet sett gir figuren et bilde av dynamikken i befolkningsendringer i ulike regiontyper i Vesteuropeiske land, med spesiell vekt på den jevne veksten i tettsteder og forsteder og variabel utvikling i byområdene.

**Gruppe 2: Mellomstore bosettingsland**

```{r}
#| echo: false
Suburb <- urb2 |> 
  select(Year = year, Country = country, Region_Type = location, Population = Pop) |> 
  filter(
    str_sub(Country, start = 1L, end = 2L) %in% c("IE", "NO", "SE")
  )
```

```{r}
#| echo: false
#| warning: false
#| message: false
#| label: fig-4
#| fig-cap: Relativ befolkningsvekst gruppe 2
Suburb <- Suburb %>%
  # Group by Country and Region Type
  group_by(Country, Region_Type) %>%
  # Calculate relative growth
  mutate(Relative_Growth = Population / Population[Year == 2005]* 100) %>%
  ungroup()

# Create a single graph with lines for each Region Type
Suburb |> 
ggplot(aes(x = Year, y = Relative_Growth, color = Region_Type)) +
  geom_smooth(level = 0.5, span = 1, linetype = 1) +
  geom_hline(yintercept = 100, linetype = "dashed", color = "black") +
  labs(title = "Relative Population Growth from 2005",
       x = "Year",
       y = "Relative Growth",
       color = "Region_Type") +
  theme_minimal() +
  scale_x_continuous(breaks = seq(2005, max(datapt1$Year), by = 5))
```

[Figur 4](#fig-4) viser en gjennomsnittlig relativ befolkningsvekst for de tre ulike regiontypene «byer», «tettsteder og forstander», og «rurale områder» fra 2005 -- 2022 for gruppe 2; Mellomliggende bosettingsland, hvor man har 2005 = 100 slik at den relative veksten har sitt utgangspunkt fra starten av perioden.
Populasjonen i tettsteder og forstander viser en markant vekst fra 2010, hvor man ser at man har vekst i både byer, tettsteder og forsteder, men en nedgang i rurale områder.
Fra gjennomgangen av dataene ser man at dersom man ikke hadde tatt med Sverige i denne gruppen hadde man fått en negativ relativ vekst i denne gruppen.
Dette viser at i gruppe 2 er det en markant trend til bosetting i tettsteder og forstander, men at det også er en vis spredning i forhold til at man velger å sentralisere seg i byer.

**Gruppe 3: Rurale land**

```{r}
#| echo: false
Rural <- urb2 |> 
  select(Year = year, Country = country, Region_Type = location, Population = Pop) |> 
  filter(
    str_sub(Country, start = 1L, end = 2L) %in% c( "PL", "PT", "SI", "SK")
  )
```

```{r}
#| echo: false
#| warning: false
#| message: false
#| label: fig-5
#| fig-cap: Relativ befolkningsvekst gruppe 3
 Rural <- Rural %>%
  # Group by Country and Region Type
  group_by(Country, Region_Type) %>%
  # Calculate relative growth
  mutate(Relative_Growth = Population / Population[Year == 2005]* 100) %>%
  ungroup()

# Create a single graph with lines for each Region Type
Rural |> 
ggplot(aes(x = Year, y = Relative_Growth, color = Region_Type)) +
  geom_smooth(level = 0.5, span = 1, linetype = 1) +
  geom_hline(yintercept = 100, linetype = "dashed", color = "black") +
  labs(title = "Relative Population Growth from 2005",
       x = "Year",
       y = "Relative Growth",
       color = "Region_Type") +
  theme_minimal() +
  scale_x_continuous(breaks = seq(2005, max(datapt1$Year), by = 5))
```

[Figur 5](#fig-5) viser den relative befolkningsveksten fra 2005, med basisår satt til 100.
Byregionene viser en nedadgående trend i befolkningsvekst etter en periode med stabilitet, som kan indikere en utflytting eller mindre tilflytting til byene.
Rurale områder har en svært liten endring, men med en svakt nedadgående trend, noe som kan speile en vedvarende netto utflytting.
Tettsteder, derimot, viser en markant økning i befolkningstallene, noe som reflekterer en sterk suburbaniseringsprosess der flere velger å bosette seg i disse områdene.
Samlet sett viser figur 5 ulike trender i befolkningsendringer i regiontyper, med en signifikant økning av befolkning i tettsteder, noe som står i kontrast til den nedadgående eller stabile utviklingen i by- og rurale områder.

### Oppsummering

...

## **Part 2: Advanced Analysis - Understanding the Impact of Economic Factors on Population Growth**

```{r}
#| echo: false
#| output: FALSE
housingprices <- read_csv("ilc_lvho07d__custom_9401957_linear.csv", 
    na = "NA")
employmentrate <- read_csv("lfst_r_erednu__custom_9401940_linear.csv", 
    na = "NA")
unemploymentrate <- read_csv("unemployment.csv", 
    na = "NA")
```

```{r}
#| echo: false
housingprices <- housingprices |> 
  select(Year = TIME_PERIOD, Country = geo, Region_Type = deg_urb, housingprices = OBS_VALUE) |> 
  mutate(Region_Type = recode(Region_Type,
                           "DEG1" = "City",
                           "DEG2" = "Suburb",
                           "DEG3" = "Rural"))
```

```{r}
#| echo: false
employmentrate <- employmentrate |> 
  filter(citizen == "TOTAL")
```

```{r}
#| echo: false
employmentrate <- employmentrate |> 
  select(Year = TIME_PERIOD, Country = geo, Region_Type = deg_urb, employmentrate = OBS_VALUE) |> 
  mutate(Region_Type = recode(Region_Type,
                           "DEG1" = "City",
                           "DEG2" = "Suburb",
                           "DEG3" = "Rural"))
```

```{r}
#| echo: false
unemploymentrate <- unemploymentrate |> 
  select(Year = TIME_PERIOD, Country = geo, Region_Type = deg_urb, unemploymentrate = OBS_VALUE) |> 
  mutate(Region_Type = recode(Region_Type,
                           "DEG1" = "City",
                           "DEG2" = "Suburb",
                           "DEG3" = "Rural"))
```

```{r}
#| echo: false
merged <- 
  merge(datapt1, unemploymentrate, by = c("Country", "Year", "Region_Type"), na.rm = TRUE) %>%
  filter(complete.cases(.))
```

```{r}
#| echo: false
merged <- merged %>% 
  merge(employmentrate, by = c("Country", "Year", "Region_Type"), na.rm = TRUE) %>%
  filter(complete.cases(.))
```

```{r}
#| echo: false
merged <- merged %>%
  merge(housingprices, by = c("Country", "Year", "Region_Type"), na.rm = TRUE) %>%
  filter(complete.cases(.))
```

```{r}
#| echo: false
merged <- merged |> 
  group_by(Country, Year) |> 
  mutate(meanUnemployment = mean(unemploymentrate, na.rm = TRUE)) |>
  ungroup()

merged <- merged |> 
  group_by(Country, Year) |> 
  mutate(meanEmploymentrate = mean(employmentrate, na.rm = TRUE)) |>
  ungroup()

merged <- merged |> 
  group_by(Country, Year) |> 
  mutate(meanHousingprices = mean(housingprices, na.rm = TRUE)) |>
  ungroup()

```

```{r}
#| echo: false
merged <- merged %>%
  mutate(Class = case_when(
    unemploymentrate > meanUnemployment & 
      employmentrate > meanEmploymentrate & 
      housingprices > meanHousingprices ~ 1,
    unemploymentrate > meanUnemployment & 
      employmentrate > meanEmploymentrate & 
      housingprices <= meanHousingprices ~ 2,
    unemploymentrate > meanUnemployment & 
      employmentrate <= meanEmploymentrate & 
      housingprices > meanHousingprices ~ 3,
    unemploymentrate > meanUnemployment & 
      employmentrate <= meanEmploymentrate & 
      housingprices <= meanHousingprices ~ 4,
    unemploymentrate <= meanUnemployment & 
      employmentrate > meanEmploymentrate & 
      housingprices > meanHousingprices ~ 5,
    unemploymentrate <= meanUnemployment & 
      employmentrate > meanEmploymentrate & 
      housingprices <= meanHousingprices ~ 6,
    unemploymentrate <= meanUnemployment & 
      employmentrate <= meanEmploymentrate & 
      housingprices > meanHousingprices ~ 7,
    unemploymentrate <= meanUnemployment & 
      employmentrate <= meanEmploymentrate & 
      housingprices <= meanHousingprices ~ 8,
    TRUE ~ 0  # Default value if none of the conditions are met
  ))
```

For å fortsette oppgaven, har vi laget oss 8 forskjellige grupper basert på 3 kriterium: arbeidsledighet (U), sysselsettingsvekst (∆E) og boligpriser (H); disse gruppene er basert på arbeidet av Andersson et al. (2019).
Ved å se på disse gruppene, og sammenligne dem med byer, tettsteder og rurale områder, kan vi undersøke sentraliseringstrender over tid, samt få en dypere forståelse av regionenes økonomiske dynamikk.
De 8 gruppene kan også gi oss et mer nyansert bilde av økonomisk vekst og boligmarkedstrender, ved å tilby en mer differensiert analyse av regionale utviklingsmønstre enn hva det å kun se på byer, tettsteder og rurale områder kan gi oss.
Gruppene er delt inn i følgende format:

1.  Høy U, høy ∆E og høy H
2.  Høy U, høy ∆E og lav H
3.  Høy U, lav ∆E og høy H
4.  Høy U, lav ∆E og lav H
5.  Lav U, høy ∆E og høy H
6.  Lav U, høy ∆E og lav H
7.  Lav U, lav ∆E og høy H
8.  Lav U, lav ∆E og lav H

Bestemmelsene for om verdiene er høye eller lave er basert på den relative størrelsen målt opp mot det samledet gjennomsnittet av alle land.
En forutsetning for økonomisk vekst i en region er en høy boligpris ettersom dette reflekterer et attraktivt området som under vekst.
Kategoriene 1-6 og 8 er høyst vektet av byer og viser en trend til sentralisering rundt bykjernen.
Kategori 7 har flest suburb og rurale regioner med høy boligpris, og viser i andre retning mot en desentralisering.

```{r}
#| echo: false
#| label: fig-6
#| fig-cap: Regiontyper gruppert etter grupper
Count <- merged %>%
  group_by(Class, Region_Type) %>%
  summarise(Count = n(), .groups = "drop")

all_classes <- as.factor(1:8)
Count |> 
ggplot(aes(x = Class, y = Count, fill = Region_Type)) +
    geom_bar(stat = "identity", position = "stack") +
    scale_x_discrete(limits = all_classes) +
    xlab("Class") +
    ylab("Region Types") +
    ggtitle("Stacked Bar Chart of Region Type Counts by Class") +
    theme(axis.text.x = element_text(angle = 45, hjust = 1)) 
```

[Figur 6](#fig-6) illustrerer variasjonen i geografiske områder basert på arbeidsledighet (U), sysselsettingsvekst (ΔE), og boligpriser (H).
Vi kan se ut ifra figuren at kategorier preget av høy arbeidsledighet og sysselsettingsvekst, kombinert med enten høye eller lave boligpriser, har en tendens til å ha en større andel byområder.
På en annen side viser kategorier med lav arbeidsledighet og sysselsettingsvekst, spesielt de med lave boligpriser, en høyere forekomst av tettsteder og rurale områder.
...

```{r}
#| echo: false
#| warning: false
#| message: false
#| label: fig-7
#| fig-cap: Relativ vekst for de 8 gruppene
merged |> 
  filter(Year >= 2005) |> 
  ggplot(
    aes(
      x = Year,
      y = Relative_Growth,
      group = Class,
      color = as.factor(Class)
    )
  ) +
  geom_smooth(span = 1, se = FALSE) +
  xlim(2005, 2022) 
```

I [figur 7](#fig-7) kan vi se hvordan den relative veksten for hver av de 8 gruppene utvikler seg.
Gruppe 2 har hatt en svært mye større vekst enn de andre gruppene...
Dersom vi filtrerer og setter den relative veksten til under 200, ser vi at de fleste gruppene har hatt en relativ liten og stabil vekst.

```{r}
merged |> 
    filter(
    str_sub(Country, start = 1L, end = 2L) %in% c("AT", "BE", "DE", "DK", "ES", "FI", "FR", "IT", "NL")
  ) |> 
    filter(Year >= 2005) |> 
  ggplot(
    aes(
      x = Year,
      y = Relative_Growth,
      group = Class,
      color = as.factor(Class)
    )
  ) +
  geom_smooth(span = 1, se = FALSE) +
  xlim(2005, 2022) 
```

```{r}
merged |> 
  filter(
    str_sub(Country, start = 1L, end = 2L) %in% c("IE", "NO", "SE")
  ) |> 
    filter(Year >= 2005) |> 
  ggplot(
    aes(
      x = Year,
      y = Relative_Growth,
      group = Class,
      color = as.factor(Class)
    )
  ) +
  geom_smooth(span = 1, se = FALSE) +
  xlim(2005, 2022) 
```

```{r}
merged |> 
  filter(
    str_sub(Country, start = 1L, end = 2L) %in% c( "PL", "PT", "SI", "SK")
  ) |> 
    filter(Year >= 2005) |> 
  ggplot(
    aes(
      x = Year,
      y = Relative_Growth,
      group = Class,
      color = as.factor(Class)
    )
  ) +
  geom_smooth(span = 1, se = FALSE) +
  xlim(2005, 2022)  
```

I [figur 7](#fig-7) kan vi se hvordan den relative veksten for hver av de 8 gruppene utvikler seg.
Gruppe 2 har hatt en svært mye større vekst enn de andre gruppene...
Dersom vi filtrerer og setter den relative veksten til under 200, ser vi at de fleste gruppene har hatt en relativ liten og stabil vekst.

```{r}
#| echo: false
#| warning: false
#| message: false
#| label: fig-8
#| fig-cap: Populasjonsvekst i de 8 forskjellige gruppene
merged |> 
  filter(Year >= 2005) |> 
  ggplot(
    aes(
      x = Year,
      y = Population,
      group = Class,
      color = as.factor(Class)
    )
  ) +
  geom_smooth(span = 1, se = FALSE) +
  xlim(2005, 2022) 
```

```{r}
#| echo: false
#| warning: false
#| message: false
#| label: fig-8
#| fig-cap: Populasjonsvekst i de 8 forskjellige gruppene
merged |> 
  filter(Year >= 2005) |> 
  ggplot(
    aes(
      x = Year,
      y = Population,
      group = Class,
      color = as.factor(Class)
    )
  ) +
  geom_smooth(span = 1, se = FALSE) +
  xlim(2005, 2022) 
```

...

## Appendix

```{r}
#| echo: false
#| warning: false
#| message: false
#| label: fig-9
#| fig-cap: Relativ populasjonsvekst gruppert etter land
# Assuming your data frame is datapt1
datapt1 <- datapt1 %>%
  # Group by Country and Region Type
  group_by(Country, Region_Type) %>%
  # Calculate relative growth
  mutate(Relative_Growth = Population / first(Population) * 100) %>%
  ungroup()

# Create a single graph with lines for each Region Type
ggplot(datapt1, aes(x = Year, y = Relative_Growth, color = Region_Type, group = Region_Type)) +
  geom_smooth(level = 0.5, span = 1, linetype = 1) +
  labs(title = "Relative Population Growth from 2003",
       x = "Year",
       y = "Relative Growth",
       color = "Region_Type") +
  theme_minimal() +
  scale_x_continuous(breaks = seq(2003, max(datapt1$Year), by = 5)) + facet_wrap(~Country)
```

```{r}
#| echo: false
#| warning: false
#| message: false
#| label: fig-10
#| fig-cap: Arbeidsledige i de forskjellige regionene
merged |> 
  filter(Class == c(1:4)) |> 
  ggplot(
    aes(
      x = Year,
      y = unemploymentrate,
      color = Region_Type
    )
  ) +
    geom_smooth(span = 0.5, se = FALSE) 
```

## Shift-Share analyse:

$$
y_r = y* + s
$$

$$
 M
$$

$$
\text{MIX} = \sum \left( \frac{E_{ir0}}{E_{r0}} \right) \left( \frac{E_{ir1}}{E_{in0}} - \frac{E_{n1}}{E_{n0}} \right)
$$

$$
\text{DIF} = \sum \left( \frac{E_{in0}}{E_{r0}} \right) \left( \frac{E_{ir1}}{E_{in0}} - \frac{E_{n1}}{E_{n0}} \right)
$$
