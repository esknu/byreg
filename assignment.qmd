---
title: "assignment"
format: html
editor: visual
---

```{r}
#| label: setup
#| output: false
#| message: false
#| echo: false
library(eurostat)
library(dineq)
library(readr)
library(tidyverse)
library(stringr)
library(huxtable)
library(vtable)
library(ggplotify)
library(grid)
library(dplyr)
library(gridExtra)
library(ggplot2)
library(broom)
library(lmtest)
library(plm)
```

## Quarto.

Quarto enables you to weave together content and executable code into a finished document.
To learn more about Quarto see <https://quarto.org>.

## Running Code

When you click the **Render** button a document will be generated that includes both content and the output of embedded code.
You can embed code like this:

```{r}
1 + 1
```

You can add options to executable code like this

```{r}
#| echo: false
2 * 2
```

The `echo: false` option disables the printing of code (only output is displayed).

```{r}
urban <- ilc_lvho01_custom_9256830_linear <- read_csv("ilc_lvho01__custom_9256830_linear.csv", 
    na = "NA")
urban <- urban |> 
  select(-DATAFLOW, -`LAST UPDATE`, -freq, -building, -OBS_FLAG, -building, -incgrp) 

urban <- urban |> 
  select(country = geo, location = deg_urb, year = TIME_PERIOD, Population = OBS_VALUE)
urban <- urban |> 
mutate(location = recode(location,
                           "DEG1" = "City",
                           "DEG2" = "Suburb",
                           "DEG3" = "Rural"))


#deg1 = city, deg2 = towns and suburbs, deg3 = Rural areas
```

```{r}
urban |> 
  filter(
    country == "IT"
  ) |> 
  ggplot(aes(
    x = year,
    y = Population,
    color = location
  )) +
  geom_line()
```

```{r}
Pop <- demo_pjan_custom_9363002_linear <- read_csv("demo_pjan__custom_9363002_linear.csv", 
    na = "NA")
```

```{r}
Pop <- Pop |> 
  select(country = geo, year = TIME_PERIOD, Population = OBS_VALUE)
```

```{r}
urb2 <- urban |> 
  left_join(Pop, urban, by = c("country", "year"))
```

```{r}
urb2 <- urb2 |> 
  mutate(
    Pop = round((Population.x * Population.y)/100, digits = 0)
  )
```

```{r}
datapt1 <- urb2 |> 
  select(Year = year, Country = country, "Region Type" = location, Population = Pop) |> 
  filter(
    str_sub(Country, start = 1L, end = 2L) %in% c("AT", "BE", "DE", "DK", "EE", "EL", "ES", "FI", "FR", "IE", "IT", "LU", "NO", "NL", "PL", "PT", "SE", "SI", "SK")
  )
```

```{r}
datapt1 |> 
  ggplot(
    aes(
      x = Year,
      y = Population,
      color = `Region Type`
    )
  ) +
  geom_smooth(level = 0.5, span = 1)
```

```{r}
# Assuming your data frame is datapt1
datapt1 <- datapt1 %>%
  # Group by Country and Region Type
  group_by(Country, `Region Type`) %>%
  # Calculate relative growth
  mutate(Relative_Growth = Population / first(Population) * 100) %>%
  ungroup()

# Create a single graph with lines for each Region Type
ggplot(datapt1, aes(x = Year, y = Relative_Growth, color = `Region Type`, group = `Region Type`)) +
  geom_smooth(level = 0.5, span = 1, linetype = 1) +
  geom_hline(yintercept = 100, linetype = "dashed", color = "black") +
  labs(title = "Relative Population Growth from 2003",
       x = "Year",
       y = "Relative Growth (%)",
       color = "Region Type") +
  theme_minimal() +
  scale_x_continuous(breaks = seq(2003, max(datapt1$Year), by = 1))
```
