---
title: "assignment"
format: html
editor: visual
---

```{r}
#| label: setup
#| output: false
#| message: false
#| echo: false
library(eurostat)
library(dineq)
library(readr)
library(tidyverse)
library(stringr)
library(huxtable)
library(vtable)
library(ggplotify)
library(grid)
library(dplyr)
library(gridExtra)
library(ggplot2)
library(broom)
library(lmtest)
library(plm)
```

Formålet og motivasjonen for denne artikkelen er å se på mulige pådrivere som påvirker by-land-skillet i Europa. For å belyse dette skal vi kritisk undersøke hvordan faktorer påvirker by-land-skillet slik som arbeidsledighetsraten, sysselsettingsvekst og det lokale boligmarkedet påvirker mønstrene for befolkningsfordelingen og jobbskapingen på tvers av ulike europeiske land.  Vi skal henholdsvis se nærmere på landene Østerrike, Belgia, Tyskland, Danmark, Estland, Hellas, Spania, Finland, Frankrike, Irland, Italia, Luxembourg, Norge, Nederland, Polen, Portugal, Sverige, Slovenia, og Slovakia.

## **Part 1: Data Collection and Initial Analysis**

```{r}
#| echo: false
#| output: FALSE
# Les inn data og deaktiver visning av kolonnetypene
urban <- read_csv("ilc_lvho01__custom_9256830_linear.csv", na = "NA", show_col_types = FALSE)

urban <- urban |> 
  select(-DATAFLOW, -`LAST UPDATE`, -freq, -building, -OBS_FLAG, -building, -incgrp) 

urban <- urban |> 
  select(country = geo, location = deg_urb, year = TIME_PERIOD, Population = OBS_VALUE)
urban <- urban |> 
  mutate(location = recode(location,
                           "DEG1" = "City",
                           "DEG2" = "Suburb",
                           "DEG3" = "Rural"))

#deg1 = city, deg2 = towns and suburbs, deg3 = Rural areas
```

```{r}
#| echo: false
#| output: FALSE
Pop <- demo_pjan_custom_9363002_linear <- read_csv("demo_pjan__custom_9363002_linear.csv", 
    na = "NA")
```

## Litteraturgjennomgang

-   Artikler

-   Teori:

    -   Budrente
        -   Fungerer til å forklare hvorfor folk bosetter seg i suburbs
        -   Viktig å få med kritiske faktorer som: Fungerer dårlig på nasjonalt nivå, best på regionalt
    -   Shift-share
        -   Den generelle veksten - eks. politikere investerer i regioner
        -   Industristruktur - hva regionen tjener penger på
        -   Shift-effekter - De elementene som beskriver spesifikke årsaker til befolkningsvekst
        -   MIX / DIF
            -   Mix: Etterspørsel - eks. økt etterspørsel etter arbeidskraft pga. utvikling i teknologi
            -   DIF: TIlbudselementet - Skiller regionen seg ut fra resten ved f.eks. FoU aktiviteter, gunstig forretningsmiljø - Kan føre til økt tilflytting og befolkningsvekst pga. konkurransedyktig arbeidsstyrke og bedre økonomiske muligheter
    -   Williams invertert U

    På midten av 1960-tallet presenterte Williamson sin teori om regionale utviklingsfaser og forskjeller i et land. Teorien gikk ut på at utvikling er konsentrert og polarisert i de tidlige stadiene, før den senere sprer seg til mer perifere områder (tettsteder og forsteder, og rurale områder). Dette gir en kurve formet som en invertert U.

    Årsakene til de økende ulikhetene er; (1) utvandring av kompetent arbeidskraft fra svake til sterke områder, (2) kapitalstrøm til de rikere regionene, tiltrukket av høyere etterspørsel, tilgjengelighet av infrastruktur, tjenester, et potensielt marked og bedre miljøforhold for bedrifter, (3) allokering av en større del av offentlige investeringer til sterke områder, som svar på etterspørsel, og (4) begrenset handel mellom regioner, slik at i de tidlige stadiene utøver ikke de rike regionene trekkraft på det fattige (KILDE, s. 105).

    Til slutt vises mekanismer som virker i motsatt retning som fører til mindre ulikheter; (1) skaping av nye jobber i mindre utviklede regioner, med den konsekvensen at utvandring avtar eller til og med stopper opp, (2) klyngeulemper, som f.eks. høye boligpriser, forurensing, trafikk og bråk, (3) vekst i offentlige investeringer i svake områder, og (4) begynnelsen av trekkraft utøvet av det sterke området på det svake (KILDE, s. 105).

    -   Tilnærmingen til sentralitet / periferi

    Sentralitets/periferitets-tilnærmingen betrakter avstanden fra sentrum av økonomiske aktiviteter som årsaken til forsinket utvikling. Enkelheten i denne tilnærmingen er også dens styrke. Den påpeker rett og slett at geografisk sentralitet i seg selv er en faktor som fremmer utvikling, mens periferi hindrer det. Faktorer som avgjør dette er; (1) tilgang til informasjon; informasjonsinnhenting er en stor kostnad, (2) teknologisk kunnskap, (3) tilgjengeligheten av markedene for varer og produksjonsfaktorer, (4) transportkostnader for ferdige varer, råvarer og halvfabrikata, og (5) forsinkelser i adopsjonen av innovasjoner (KILDE, s. 111) ( KAP 11).

    -   Hypotese
        -   Budrente: Folk vi bo der de får mest for pengene
        -   Shift-Share: Ift. artikkelen har det blitt bedre i europa, gjør at folk kan bo lengre unna sentrum pga økt teknologisk utvikling / infrastruktur(?)
        -   ? : Trender mot suburb og folk velger desentralisering fra byer

-   Drøfting:

    -   Kap 8, 9 og 10 som støtteargumenter, IKKE SOM EGEN TEORI!

### **Data Analysis:**

For å se nærmere på by-land-skillet trekker vi ut 3 underkatogorier av variabelen 'Region Type' i form av; 

-   Byer (tett befolkede områder)

-   Tettsteder og forsteder (områder med middels tetthet)

-   Rurale områder (tynt befolkede områder)

Vi skal nå analysere befolkningsveksttrender ved hjelp av disse kategoriene. 

```{r}
#| echo: false
Pop <- Pop |> 
  select(country = geo, year = TIME_PERIOD, Population = OBS_VALUE)
```

```{r}
#| echo: false
urb2 <- urban |> 
  left_join(Pop, urban, by = c("country", "year"))
```

```{r}
#| echo: false
urb2 <- urb2 |> 
  mutate(
    Pop = round((Population.x * Population.y)/100, digits = 0)
  )
```

```{r}
#| echo: false
datapt1 <- urb2 |> 
  select(Year = year, Country = country, Region_Type = location, Population = Pop) |> 
  filter(
    str_sub(Country, start = 1L, end = 2L) %in% c("AT", "BE", "DE", "DK", "ES", "FI", "FR", "IE", "IT", "NO", "NL", "PL", "PT", "SE", "SI", "SK")
  )
```

```{r}
#| echo: false
datapt1 |> 
  ggplot(
    aes(
      x = Year,
      y = Population,
      color = Region_Type
    )
  ) +
  geom_smooth(level = 0.5, span = 1)
```

Figur 1 viser gjennomsnittlig befolkningsvekst for de tre ulike regiontypene fra 2003 til 2022. Vi ser at byer har hatt den største veksten i populasjon fra 2003 til omtrent 2010, hvor den fra 2010 synker gradvis før den flater ut fra 2017 til 2022. Tettsteder og forsteder har en jevn stigning fra året 2003 til 2022. Rurale områder har en jevn stigning frem til 2015, før man har en slak nedgang frem til 2022. 

Befolkningstrenden tyder på at frem til 2010 velger den største delen av befolkningen i Europa å bosette seg i byer, dvs. det har vært en økt sentralisering. Fra 2010 synker bosettingen i byer, som tyder på infrastrukturen i Europa har blitt bedre. Ved bruk av budrentemodellen kan dette tyde på at man får mer for pengene i kategoriene tettsteder/forsteder og rurale områder. Når vi ser på tettsteder/forsteder og rurale områder ser vi at disse to frem til 2016 tar over den største veksten i bosetting, hvor man fra 2016/2017 ser at det kun er tettsteder som har en vekst. 

Det er verdt å merke seg at Figur 1 ikke er en særlig god fremstilling da dataene ikke har sitt opphav i 2003, hvor vi derfor bedre kan belyse dette med å sitte 2003 som et index år. Ved å gjøre dette vil vi da kunne se på den relative veksten i forhold til dette index året og vil da være mer representativt for en befolkningsvekst eller befolkningsnedgang i perioden 2003-2022.

Figur 2 gir et mer nøyaktig bilde av de relative endringene i befolkningsutviklingen på tvers av de tre ulike kategoriene. Tidsseriene for kategoriene er skalert med en faktor som definerer befolkningen til å være 100 i 2003. Dermed representerer kurvene prosentvis befolkningsvekst over perioden.

```{r}
#| echo: false
# Assuming your data frame is datapt1
datapt1 <- datapt1 %>%
  # Group by Country and Region_Type
  group_by(Country, Region_Type) %>%
  # Calculate relative growth
  mutate(Relative_Growth = Population / Population[Year == 2005]* 100) %>%
  ungroup()

# Create a single graph with lines for each Region Type
datapt1 |> 
ggplot(aes(x = Year, y = Relative_Growth, color = Region_Type)) +
  geom_smooth(level = 0.5, span = 0.25, linetype = 1, se = FALSE) +
  geom_hline(yintercept = 100, linetype = "dashed", color = "black") +
  labs(title = "Relative Population Growth from 2005",
       x = "Year",
       y = "Relative Growth",
       color = "Region_Type") +
  theme_minimal() +
  scale_x_continuous(breaks = seq(2005, max(datapt1$Year), by = 5)) +
  xlim(2005, 2022) 
```

**Espen: Figur 2 viser ​​​​gjennomsnittlig relativ befolkningsvekst, hvor 2003 = 100.**

Videre skal vi utforske variasjoner for ulike europeiske land. Vi har gjort dette ved å dele det europeiske utvalget av land fra Eurostat inn i tre hovedgrupper for å muliggjøre en meningsfull sammenligning av variasjoner i forhold til bosettingsmønstre og utvikling. Disse gruppene er definert ut fra geografisk beliggenhet og generelle økonomiske kjennetegn.

**Gruppe 1: Vesteuropeiske land**

Denne gruppen omfatter land med høy grad av urbanisering og velutviklede økonomier. Landene i denne gruppen, inkludert Østerrike, Belgia, Tyskland, og Frankrike, kjennetegnes av tettpakkede byområder og generelt høy befolkningstetthet (<https://fn.no/verdenskart>). Denne inndelingen gir et grunnlag for å analysere lignende utviklingsmønstre og utfordringer knyttet til urban og regional utvikling.

**Gruppe 2: Mellomeuropeiske land**

Denne gruppen inkluderer land med en mellomgrad av urbanisering og varierte økonomiske forhold. Irland, Norge, og Sverige er eksempler på land i denne gruppen, som har en balanse mellom byutvikling og forsteder, samt en betydelig andel av befolkningen som bor i mindre tett befolkede områder. Analyse av disse landene kan bidra til å avdekke regionale forskjeller og tilpasninger til demografiske og økonomiske endringer.

**Gruppe 3: Østeuropeiske land**

Denne gruppen omfatter land med lavere urbanisering og økonomier i utvikling. Land som Estland, Hellas, Polen, og Portugal er eksempler på land i denne gruppen, preget av en overvekt av tynnere befolkede områder og landlige samfunn. Analyse av disse landene gir innsikt i spesifikke utfordringer knyttet til landlig utvikling og tilpasning til endringer i moderne samfunn.

Det er viktig å merke seg at disse inndelingene er forenklede og bør tilpasses spesifikke forskningsspørsmål og tilgjengelig data, f.eks. for å unngå MAUP (Modifiable Areal Unit Problem). Faktorer som historisk kontekst, politiske systemer, og kulturelle påvirkninger kan ytterligere informere analysen av variansene innenfor hver landsgruppe.

**Group 1: Urbanized Countries (Cities)**

```{r}
#| echo: false
City <- urb2 |> 
  select(Year = year, Country = country, Region_Type = location, Population = Pop) |> 
  filter(
    str_sub(Country, start = 1L, end = 2L) %in% c("AT", "BE", "DE", "DK", "ES", "FI", "FR", "IT", "NL")
  )
```

```{r}
#| echo: false
City <- City %>%
  # Group by Country and Region Type
  group_by(Country, Region_Type) %>%
  # Calculate relative growth
  mutate(Relative_Growth = Population / Population[Year == 2005]* 100) %>%
  ungroup()

# Create a single graph with lines for each Region Type
City |> 
ggplot(aes(x = Year, y = Relative_Growth, color = Region_Type)) +
  geom_smooth(level = 0.5, span = 1, linetype = 1) +
  geom_hline(yintercept = 100, linetype = "dashed", color = "black") +
  labs(title = "Relative Population Growth from 2003",
       x = "Year",
       y = "Relative Growth",
       color = "Region_Type") +
  theme_minimal() +
  scale_x_continuous(breaks = seq(2005, max(datapt1$Year), by = 5))
```

Figur 3 viser gjennomsnittlig relativ befolkningsvekst for de tre ulike regiontypene fra 2005 til 2022 for gruppe 1: Vesteuropeiske land, hvor 2005 = 100. Populasjonen i rurale områder har opplevd en markant vekst fra 2005 til omtrent 2017, etterfulgt av en betydelig nedgang. Denne trenden kan tyde på perioder med økt attraktivitet for rural bosetting, etterfulgt av utfordringer eller endringer som fører til nedgangen. Tettsteder og forsteder har vist en jevn stigning i befolkningsvekst fra 2005 til 2022. Dette kan reflektere en pågående urbaniserings- og suburbaniseringsprosess, der disse områdene forblir attraktive for bosetting. Byområder har hatt en stabil befolkningsutvikling fra 2005 til omtrent 2010, etterfulgt av en nedgang frem til omtrent 2016. Deretter har det vært en moderat økning frem til 2022. Denne komplekse trenden kan indikere variasjoner i byenes attraktivitet eller endringer i byutviklingsmønstre over tid.

Samlet sett gir figuren et bilde av dynamikken i befolkningsendringer i ulike regiontyper i Vesteuropeiske land, med spesiell vekt på den jevne veksten i tettsteder og forsteder og variabel utvikling i byområdene.

**Group 2: Intermediate Settlement Countries (Towns and Suburbs)**

```{r}
#| echo: false
Suburb <- urb2 |> 
  select(Year = year, Country = country, Region_Type = location, Population = Pop) |> 
  filter(
    str_sub(Country, start = 1L, end = 2L) %in% c("IE", "NO", "SE")
  )
```

```{r}
#| echo: false
Suburb <- Suburb %>%
  # Group by Country and Region Type
  group_by(Country, Region_Type) %>%
  # Calculate relative growth
  mutate(Relative_Growth = Population / Population[Year == 2005]* 100) %>%
  ungroup()

# Create a single graph with lines for each Region Type
Suburb |> 
ggplot(aes(x = Year, y = Relative_Growth, color = Region_Type)) +
  geom_smooth(level = 0.5, span = 1, linetype = 1) +
  geom_hline(yintercept = 100, linetype = "dashed", color = "black") +
  labs(title = "Relative Population Growth from 2003",
       x = "Year",
       y = "Relative Growth",
       color = "Region_Type") +
  theme_minimal() +
  scale_x_continuous(breaks = seq(2005, max(datapt1$Year), by = 5))
```

Figur 4 viser en gjennomsnittlig relativ befolkningsvekst for de tre ulike regiontypene «byer», «tettsteder og forstander», og «rurale områder» fra 2005 -- 2022 for gruppe 2; Mellomliggende bosettingsland, hvor man har 2005 = 100 slik at den relative veksten har sitt utgangspunkt fra starten av perioden. Populasjonen i tettsteder og forstander viser en markant vekst fra 2010, hvor man ser at man har vekst i både byer, tettsteder og forsteder, men en nedgang i rurale områder. Fra gjennomgangen av dataene ser man at dersom man ikke hadde tatt med Sverige i denne gruppen hadde man fått en negativ relativ vekst i denne gruppen. Dette viser at i gruppe 2 er det en markant trend til bosetting i tettsteder og forstander, men at det også er en vis spredning i forhold til at man velger å sentralisere seg i byer.

**Group 3: Rural Countries (Rural Areas)**

```{r}
#| echo: false
Rural <- urb2 |> 
  select(Year = year, Country = country, Region_Type = location, Population = Pop) |> 
  filter(
    str_sub(Country, start = 1L, end = 2L) %in% c( "PL", "PT", "SI", "SK")
  )
```

```{r}
#| echo: false
 Rural <- Rural %>%
  # Group by Country and Region Type
  group_by(Country, Region_Type) %>%
  # Calculate relative growth
  mutate(Relative_Growth = Population / Population[Year == 2005]* 100) %>%
  ungroup()

# Create a single graph with lines for each Region Type
Rural |> 
ggplot(aes(x = Year, y = Relative_Growth, color = Region_Type)) +
  geom_smooth(level = 0.5, span = 1, linetype = 1) +
  geom_hline(yintercept = 100, linetype = "dashed", color = "black") +
  labs(title = "Relative Population Growth from 2003",
       x = "Year",
       y = "Relative Growth",
       color = "Region_Type") +
  theme_minimal() +
  scale_x_continuous(breaks = seq(2005, max(datapt1$Year), by = 5))
```

Figur 5 viser den relative befolkningsveksten fra 2005, med basisår satt til 100. Byregionene viser en nedadgående trend i befolkningsvekst etter en periode med stabilitet, som kan indikere en utflytting eller mindre tilflytting til byene. Rurale områder har en svært liten endring, men med en svakt nedadgående trend, noe som kan speile en vedvarende netto utflytting. Tettsteder, derimot, viser en markant økning i befolkningstallene, noe som reflekterer en sterk suburbaniseringsprosess der flere velger å bosette seg i disse områdene. Samlet sett viser figur 5 ulike trender i befolkningsendringer i regiontyper, med en signifikant økning av befolkning i tettsteder, noe som står i kontrast til den nedadgående eller stabile utviklingen i by- og rurale områder.

### Teori - Del 1

**Kap. 4: Williamson - Stages of development and disparities**

I vår analyse de siste 20 årene i Europa ser vi at byområder har opplevd moderat vekst, noe som indikerer at det fremdeles finner en viss attraktivitet. Samtidig har forsteder og tettsteder vokst betydelig, noe som antyder en pågående urbaniserings- og suburbaniseringsprosess, hvor disse områdene blir mer attraktive for bosetting. Rurale områder har vist variabel utvikling, med markant vekst i noen perioder og svakt nedadgående trender i andre, reflekterende komplekse mønstre i befolkningsendringer.

De observerte tendensene indikerer derfor ikke bare en reduksjon i regionale ulikheter, men også en dynamikk i hvilke typer områder som opplever vekst. Byer opprettholder sin appell, mens forsteder og tettsteder har blitt betydelig mer attraktive for bosetting. Rurale områder viser variabilitet og kan være påvirket av faktorer som økt suburbanisering og endringer i næringslivet. Dette gir en viss støtte til Williamson's teori om hvordan utvikling og regionale forskjeller utvikler seg over tid, samtidig som den gir innsikt i de spesifikke dynamikkene innenfor hver regiontype.

**Kap. 4: Tilnærmingen til sentralitet/periferi**

Våre funn indikerer en tendens til desentralisering i Europa, hvor byområder har opplevd moderat vekst, mens forsteder og tettsteder har hatt betydelig vekst. Rurale områder har vist variabel utvikling, med markert vekst i noen perioder og svake nedadgående trender i andre. Det kan være en forsinket utvikling i forsteder og tettsteder på grunn av avstanden til sentrum, men nå har utviklingen gjort disse områdene mer tilgjengelige og attraktive for bosetting. Den begrensede befolkningsveksten i rurale områder kan mest sannsynlig tilskrives deres større periferitet sammenlignet med forsteder og tettsteder. Slik sett støtter våre funn i stor grad sentralitets/periferitets-tilnærmingens teoretiske rammer, da avstand fra sentrum av økonomiske aktiviteter synes å påvirke utviklingen i ulike regiontyper.

## **Part 2: Advanced Analysis - Understanding the Impact of Economic Factors on Population Growth**

### **Task 1: Gathering Additional Data**

```{r}
#| echo: false
#| output: FALSE
housingprices <- read_csv("ilc_lvho07d__custom_9401957_linear.csv", 
    na = "NA")
employmentrate <- read_csv("lfst_r_erednu__custom_9401940_linear.csv", 
    na = "NA")
unemploymentrate <- read_csv("unemployment.csv", 
    na = "NA")
```

```{r}
#| echo: false
housingprices <- housingprices |> 
  select(Year = TIME_PERIOD, Country = geo, Region_Type = deg_urb, housingprices = OBS_VALUE) |> 
  mutate(Region_Type = recode(Region_Type,
                           "DEG1" = "City",
                           "DEG2" = "Suburb",
                           "DEG3" = "Rural"))
```

```{r}
#| echo: false
employmentrate <- employmentrate |> 
  filter(citizen == "TOTAL")
```

```{r}
#| echo: false
employmentrate <- employmentrate |> 
  select(Year = TIME_PERIOD, Country = geo, Region_Type = deg_urb, employmentrate = OBS_VALUE) |> 
  mutate(Region_Type = recode(Region_Type,
                           "DEG1" = "City",
                           "DEG2" = "Suburb",
                           "DEG3" = "Rural"))
```

```{r}
#| echo: false
unemploymentrate <- unemploymentrate |> 
  select(Year = TIME_PERIOD, Country = geo, Region_Type = deg_urb, unemploymentrate = OBS_VALUE) |> 
  mutate(Region_Type = recode(Region_Type,
                           "DEG1" = "City",
                           "DEG2" = "Suburb",
                           "DEG3" = "Rural"))
```

### **Task 2: Application of Classification Methodology**

```{r}
#| echo: false
merged <- 
  merge(datapt1, unemploymentrate, by = c("Country", "Year", "Region_Type"), na.rm = TRUE) %>%
  filter(complete.cases(.))
```

```{r}
#| echo: false
merged <- merged %>% 
  merge(employmentrate, by = c("Country", "Year", "Region_Type"), na.rm = TRUE) %>%
  filter(complete.cases(.))
```

```{r}
#| echo: false
merged <- merged %>%
  merge(housingprices, by = c("Country", "Year", "Region_Type"), na.rm = TRUE) %>%
  filter(complete.cases(.))
```

```{r}
#| echo: false
merged <- merged |> 
  group_by(Country, Year) |> 
  mutate(meanUnemployment = mean(unemploymentrate, na.rm = TRUE)) |>
  ungroup()

merged <- merged |> 
  group_by(Country, Year) |> 
  mutate(meanEmploymentrate = mean(employmentrate, na.rm = TRUE)) |>
  ungroup()

merged <- merged |> 
  group_by(Country, Year) |> 
  mutate(meanHousingprices = mean(housingprices, na.rm = TRUE)) |>
  ungroup()

```

```{r}
#| echo: false
merged <- merged %>%
  mutate(Class = case_when(
    unemploymentrate > meanUnemployment & 
      employmentrate > meanEmploymentrate & 
      housingprices > meanHousingprices ~ 1,
    unemploymentrate > meanUnemployment & 
      employmentrate > meanEmploymentrate & 
      housingprices <= meanHousingprices ~ 2,
    unemploymentrate > meanUnemployment & 
      employmentrate <= meanEmploymentrate & 
      housingprices > meanHousingprices ~ 3,
    unemploymentrate > meanUnemployment & 
      employmentrate <= meanEmploymentrate & 
      housingprices <= meanHousingprices ~ 4,
    unemploymentrate <= meanUnemployment & 
      employmentrate > meanEmploymentrate & 
      housingprices > meanHousingprices ~ 5,
    unemploymentrate <= meanUnemployment & 
      employmentrate > meanEmploymentrate & 
      housingprices <= meanHousingprices ~ 6,
    unemploymentrate <= meanUnemployment & 
      employmentrate <= meanEmploymentrate & 
      housingprices > meanHousingprices ~ 7,
    unemploymentrate <= meanUnemployment & 
      employmentrate <= meanEmploymentrate & 
      housingprices <= meanHousingprices ~ 8,
    TRUE ~ 0  # Default value if none of the conditions are met
  ))
```

### **Task 3: Analysis and Visualization**

For å fortsette oppgaven, har vi laget oss 8 forskjellige grupper basert på 3 kriterium: arbeidsledighet (U), sysselsettingsvekst (∆E) og boligpriser (H); disse gruppene er basert på arbeidet av Andersson et al. (2019). Ved å se på disse gruppene, og sammenligne dem med byer, tettsteder og rurale områder, kan vi undersøke sentraliseringstrender over tid, samt få en dypere forståelse av regionenes økonomiske dynamikk. De 8 gruppene kan også gi oss et mer nyansert bilde av økonomisk vekst og boligmarkedstrender, ved å tilby en mer differensiert analyse av regionale utviklingsmønstre enn hva det å kun se på byer, tettsteder og rurale områder kan gi oss.

```{r}
#| echo: false
Count <- merged %>%
  group_by(Class, Region_Type) %>%
  summarise(Count = n(), .groups = "drop")

all_classes <- as.factor(1:8)
Count |> 
ggplot(aes(x = Class, y = Count, fill = Region_Type)) +
    geom_bar(stat = "identity", position = "stack") +
    scale_x_discrete(limits = all_classes) +
    xlab("Class") +
    ylab("Region Types") +
    ggtitle("Stacked Bar Chart of Region Type Counts by Class") +
    theme(axis.text.x = element_text(angle = 45, hjust = 1)) 
```

Figur X illustrerer variasjonen i geografiske områder basert på arbeidsledighet (U), sysselsettingsvekst (ΔE), og boligpriser (H). Vi kan se ut ifra figuren at kategorier preget av høy arbeidsledighet og sysselsettingsvekst, kombinert med enten høye eller lave boligpriser, har en tendens til å ha en større andel byområder. På en annen side viser kategorier med lav arbeidsledighet og sysselsettingsvekst, spesielt de med lave boligpriser, en høyere forekomst av tettsteder og rurale områder. ...

```{r}
#| echo: false
merged |> 
  filter(Year >= 2005) |> 
  ggplot(
    aes(
      x = Year,
      y = Relative_Growth,
      group = Class,
      color = as.factor(Class)
    )
  ) +
  geom_smooth(span = 1, se = FALSE) +
  xlim(2005, 2022) 
```

I figur X kan vi se hvordan den relative veksten for hver av de 8 gruppene utvikler seg. Gruppe 2 har hatt en svært mye større vekst enn de andre gruppene. Dersom vi filtrerer og setter den relative veksten til under 200, ser vi at de fleste gruppene har hatt en relativ liten og stabil vekst.

### **Task 4: Interpretation and Relation to Course Literature**

```{r}
#| echo: false
merged |> 
  filter(Year >= 2005) |> 
  ggplot(
    aes(
      x = Year,
      y = Population,
      group = Class,
      color = as.factor(Class)
    )
  ) +
  geom_smooth(span = 1, se = FALSE) +
  xlim(2005, 2022) 
```

## Shift-Share analyse:

```{r}

```

$$
y_r = y* + s
$$

$$
 M
$$

$$
\text{MIX} = \sum \left( \frac{E_{ir0}}{E_{r0}} \right) \left( \frac{E_{ir1}}{E_{in0}} - \frac{E_{n1}}{E_{n0}} \right)
$$

$$
\text{DIF} = \sum \left( \frac{E_{in0}}{E_{r0}} \right) \left( \frac{E_{ir1}}{E_{in0}} - \frac{E_{n1}}{E_{n0}} \right)
$$

## Drøfting

-   Kap 8, 9 og 10 som støtteargumenter, IKKE SOM EGEN TEORI!

## Appendix

```{r}
#| echo: false
# Assuming your data frame is datapt1
datapt1 <- datapt1 %>%
  # Group by Country and Region Type
  group_by(Country, Region_Type) %>%
  # Calculate relative growth
  mutate(Relative_Growth = Population / first(Population) * 100) %>%
  ungroup()

# Create a single graph with lines for each Region Type
ggplot(datapt1, aes(x = Year, y = Relative_Growth, color = Region_Type, group = Region_Type)) +
  geom_smooth(level = 0.5, span = 1, linetype = 1) +
  labs(title = "Relative Population Growth from 2003",
       x = "Year",
       y = "Relative Growth",
       color = "Region_Type") +
  theme_minimal() +
  scale_x_continuous(breaks = seq(2003, max(datapt1$Year), by = 5)) + facet_wrap(~Country)
```

```{r}
#| echo: false
merged |> 
  filter(Class == c(1:4)) |> 
  ggplot(
    aes(
      x = Year,
      y = unemploymentrate,
      color = Region_Type
    )
  ) +
    geom_smooth(span = 0.5, se = FALSE) 
```

```{r}
#| echo: false
merged |> 
  filter(Class == 5) |> 
  arrange(Year) |> 
  tibble()
```
